# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∫ –∑–∞–Ω—è—Ç–∏—é  ¬´–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ. –ß–∞—Å—Ç—å 2¬ª - –°–ø–µ—Ç–Ω–∏—Ü–∫–∏–π –î.–ò.




## –ó–∞–¥–∞–Ω–∏–µ 1



–û–ø–∏—à–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–∞–º–∏:

-   –∞–∫—Ç–∏–≤–Ω—ã–π master-—Å–µ—Ä–≤–µ—Ä –∏ –ø–∞—Å—Å–∏–≤–Ω—ã–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π slave-—Å–µ—Ä–≤–µ—Ä;
-   master-—Å–µ—Ä–≤–µ—Ä –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ slave-—Å–µ—Ä–≤–µ—Ä–æ–≤;

_–î–∞–π—Ç–µ –æ—Ç–≤–µ—Ç –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ._

---

## –†–µ—à–µ–Ω–∏–µ 1

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å—Ö–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. –ê–∫—Ç–∏–≤–Ω—ã–π –º–∞—Å—Ç–µ—Ä + –ø–∞—Å—Å–∏–≤–Ω—ã–π —Å–ª–µ–π–≤ (1:1)



-   **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å ¬´–Ω–∞ —Å–ª—É—á–∞–π –ß–ü¬ª** ‚Äî –µ—Å–ª–∏ –º–∞—Å—Ç–µ—Ä —É–ø–∞–¥—ë—Ç (–ø–æ–ª–æ–º–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞, —Å–µ—Ç—å –ø—Ä–æ–ø–∞–ª–∞), —Å–ª–µ–π–≤ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ ¬´—Ä–∞—Å–∫–∞—á–∞—Ç—å¬ª –≤ –Ω–æ–≤–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –¥–∞—É–Ω—Ç–∞–π–º–∞.
-   **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Äî –≤—Å–µ–≥–æ –¥–≤–∞ —Å–µ—Ä–≤–µ—Ä–∞, –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞, –ø—Ä–æ—â–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π.
-   **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è ¬´–∂–∏–≤–∞—è¬ª** ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–ª–µ–π–≤–µ –ø–æ—á—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Å –º–∞—Å—Ç–µ—Ä–∞. –≠—Ç–æ –Ω–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±—ç–∫–∞–ø (–µ—Å–ª–∏ –Ω–∞ –º–∞—Å—Ç–µ—Ä–µ —É–¥–∞–ª–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ ‚Äî —É–¥–∞–ª—è—Ç—Å—è –∏ –Ω–∞ —Å–ª–µ–π–≤–µ), –Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ —Å–±–æ—è –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ.
-   **–†–∞–∑–≥—Ä—É–∑–∫–∞ –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –æ—Ç—á—ë—Ç–æ–≤** ‚Äî –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–ª–µ–π–≤–µ, —á—Ç–æ–±—ã –Ω–µ —Ç–æ—Ä–º–æ–∑–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –Ω–∞ –º–∞—Å—Ç–µ—Ä–µ.

–ú–∏–Ω—É—Å: –æ–¥–∏–Ω —Å–ª–µ–π–≤ ‚Äî —ç—Ç–æ ¬´–æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞¬ª –¥–ª—è —Å–∞–º–æ–≥–æ —Å–ª–µ–π–≤–∞. –ï—Å–ª–∏ –æ–Ω —É–ø–∞–¥—ë—Ç ‚Äî —Ä–µ–∑–µ—Ä–≤–∞ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è.

#### 2. –ú–∞—Å—Ç–µ—Ä + –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–µ–π–≤–æ–≤ (1:N)


-   **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ‚Äî —ç—Ç–æ `SELECT`. –°–ª–µ–π–≤—ã –±–µ—Ä—É—Ç –Ω–∞ —Å–µ–±—è —á—Ç–µ–Ω–∏–µ, –º–∞—Å—Ç–µ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è —Å–≤–æ–±–æ–¥–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏. –ß–µ–º –±–æ–ª—å—à–µ —Å–ª–µ–π–≤–æ–≤ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
-   **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** ‚Äî –º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å–ª–µ–π–≤—ã –≤ —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞—Ö –∏–ª–∏ –¥–∞–∂–µ —Å—Ç—Ä–∞–Ω–∞—Ö. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ –ï–≤—Ä–æ–ø—ã —á–∏—Ç–∞—é—Ç —Å –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–≥–æ —Å–ª–µ–π–≤–∞, –∏–∑ –ê–∑–∏–∏ ‚Äî —Å –∞–∑–∏–∞—Ç—Å–∫–æ–≥–æ. –°–Ω–∏–∂–∞–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞.
-   **–í—ã—Å–æ–∫–∞—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω —Å–ª–µ–π–≤ —É–ø–∞–¥—ë—Ç, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –î–∞–∂–µ –µ—Å–ª–∏ –º–∞—Å—Ç–µ—Ä –≤—ã–π–¥–µ—Ç –∏–∑ —Å—Ç—Ä–æ—è, –ª—é–±–æ–π –∏–∑ —Å–ª–µ–π–≤–æ–≤ –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–æ–≤—ã–º –º–∞—Å—Ç–µ—Ä–æ–º.
-   **–ì–∏–±–∫–æ—Å—Ç—å –ø–æ–¥ –∑–∞–¥–∞—á–∏** ‚Äî –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–µ–π–≤ –ø–æ–¥ –æ—Ç—á—ë—Ç—ã, –¥—Ä—É–≥–æ–π ‚Äî –ø–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç—Ä–µ—Ç–∏–π ‚Äî –¥–ª—è –±—ç–∫–∞–ø–∞. –û–¥–∏–Ω —Å–ª–µ–π–≤ –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å —Ç–∞–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π.

–ú–∏–Ω—É—Å: —Å–ª–æ–∂–Ω–µ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å (–Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –Ω–∞ –≤—Å–µ—Ö —Å–ª–µ–π–≤–∞—Ö), –≤—ã—à–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.


---

## –ó–∞–¥–∞–Ω–∏–µ 2


–†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –ø–ª–∞–Ω –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —à–∞—Ä–∏–Ω–≥–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö —Ç–∞–±–ª–∏—Ü:

- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏,
- –∫–Ω–∏–≥–∏,
- –º–∞–≥–∞–∑–∏–Ω—ã (—Å—Ç–æ–ª–±—Ü—ã –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ).

–û–ø–∏—à–∏—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –∏—Ö —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–ª–∏ —Ä–∞–∑–±–∏–≤–∫—É –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.

*–ü—Ä–∏—à–ª–∏—Ç–µ –±–ª–æ–∫—Å—Ö–µ–º—É, –≥–¥–µ –∏ —á—Ç–æ –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è. –û–ø–∏—à–∏—Ç–µ, –≤ –∫–∞–∫–∏—Ö —Ä–µ–∂–∏–º–∞—Ö –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–∞.*

---

## –†–µ—à–µ–Ω–∏–µ 2


### üìù –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:

#### 1. **–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —à–∞—Ä–¥–∏–Ω–≥**

-   –¢–∞–±–ª–∏—Ü—ã `users` –∏ `stores` –≤—ã–Ω–µ—Å–µ–Ω—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã (`users_shard`, `stores_shard`)
-   –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è —Å–≤–æ–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º
-   –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –º–∞–≥–∞–∑–∏–Ω—ã)

#### 2. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —à–∞—Ä–¥–∏–Ω–≥**

-   –¢–∞–±–ª–∏—Ü–∞ `books` —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ 3 —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —à–∞—Ä–¥–∞ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –¥–∞—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
-   –ö–ª—é—á —à–∞—Ä–¥–∏–Ω–≥–∞: `published_date`
-   –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
-   –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `UUID` –¥–ª—è `book_id`

#### 3. **–ü—Ä–æ–∫—Å–∏-—É—Ä–æ–≤–µ–Ω—å (`main_db`)**

-   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `postgres_fdw` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü
-   –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `VIEW books_view = UNION ALL`
-   –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `RULES` (INSERT/UPDATE/DELETE)
-   –†–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å `main_db`

#### 4. **–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–æ–≤**



| –°–µ—Ä–≤–µ—Ä  | –†–µ–∂–∏–º | –§—É–Ω–∫—Ü–∏—è |
|-------|-----|------------|
| main_db | Proxy  | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö   |
| users_shard   | Master (R/W)  | –•—Ä–∞–Ω–∏—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `users`   |
| stores_shard  | Master (R/W)  | –•—Ä–∞–Ω–∏—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `stores` |
| books_shard_1/2/3  | Master (R/W)  | –•—Ä–∞–Ω—è—Ç —á–∞—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã `books` –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –¥–∞—Ç |

#### 5 –ë–ª–æ–∫-—Å—Ö–µ–º–∞
![2.1.png](img/2.1.png)





---


## –ó–∞–¥–∞–Ω–∏–µ 3*

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —à–∞—Ä–¥–∏–Ω–≥–∞ –∏–∑ –∑–∞–¥–∞–Ω–∏—è 2.

*–ü—Ä–∏—à–ª–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥ Docker –∏ SQL —Å–∫—Ä–∏–ø—Ç —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö*.

---

## –†–µ—à–µ–Ω–∏–µ 3

[sharding](sharding)




---